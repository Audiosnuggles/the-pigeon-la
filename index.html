<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>The Pigeon</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <link rel="stylesheet" href="style.css?v=58">
</head>
<body>

  <div id="mobile-overlay">
    <div class="overlay-content">
      <img src="pigeon.svg" alt="Pigeon">
      <div class="text-box">
        <p class="warning">Howdy Visitor!</p>
        <p class="instruction">
          The Pigeon is not mobile optimized yet. It's a bit of a desktop diva! <br><br>
          But hey, you can still try to tame it: Just rotate your device to <strong>landscape mode</strong> and hit that <strong>fullscreen</strong> button. 
          Enjoy the flight!
        </p>
      </div>
    </div>
  </div>

  <div id="help-overlay">
    <div class="help-content">
      <button id="closeHelpBtn">X</button>
      <h2>The Pigeon - User Manual</h2>
      <div class="help-grid-expanded">
        
        <div class="help-section">
          <h3>1. Tracks & Drawing</h3>
          <p><strong>Oscillators (‚àø ‚éç ‚ó∫):</strong> Choose the waveform for the track. <strong>‚àø (Sine)</strong> for smooth bass/leads, <strong>‚éç (Square)</strong> for hollow 8-bit sounds, or <strong>‚ó∫ (Sawtooth)</strong> for sharp, buzzing synths.</p>
          <p><strong>Track Controls:</strong> The <strong>Color Strip</strong> indicates the track (T1-T4). Use <strong>Mute</strong> to silence a track, and the <strong>Volume Slider</strong> below it to adjust its level.</p>
          <p><strong>Snap:</strong> Check 'Snap' to quantize your drawing. The track is divided into steps, snapping your notes precisely to a rhythmic grid.</p>
          <p><strong>Drawing:</strong> Left-click and drag on the canvas. High up = high pitch, lower down = low pitch.</p>
        </div>

        <div class="help-section">
          <h3>2. Performance & FX Rack</h3>
          <p><strong>Performance (T1-T4):</strong> Select the track you want to control live. Use <strong>Clear Track</strong> to quickly erase all drawings on it.</p>
          <p><strong>Poke Me Pad:</strong> A live trigger! Click and hold inside the square. X-axis = timeline position, Y-axis = pitch/frequency.</p>
          <p><strong>FX Matrix:</strong> 6 effect modules. Click the 4 colored squares (representing T1-T4) to route a track into an effect. The green LED shows if the effect is active.</p>
          <p><strong>X/Y Link:</strong> Turn this ON to hijack the 'Poke Me' pad. Drawing stops, and the Pad now controls the two effect knobs live (X-Axis = Left Knob, Y-Axis = Right Knob).</p>
        </div>

        <div class="help-section">
          <h3>3. Global Controls & Tools</h3>
          <p><strong>Sync & Tempo:</strong> Use <strong>EXT SYNC</strong> to lock The Pigeon to an external MIDI Clock (e.g., Ableton). Select your device from the dropdown.</p>
          <p><strong>Loop & Harmonize:</strong> Check <strong>Loop</strong> for infinite playback. <strong>Harmonize</strong> forces your drawn frequencies into a perfect musical <strong>Scale</strong> (Major, Minor, Pentatonic).</p>
          <p><strong>Tool & Brush:</strong> Switch between <strong>Draw</strong> and <strong>Eraser</strong>. The <strong>Brush</strong> dropdown offers wild textures (Standard, Particles, Fractal, or Chords). Adjust the stroke with the <strong>Size</strong> slider.</p>
        </div>

        <div class="help-section">
          <h3>üîå Studio Sync (Ableton Live)</h3>
          <p><strong>1. Virtual Cable:</strong> Aktiviere den <em>IAC-Treiber</em> (Mac) im Audio-MIDI-Setup oder installiere <em>loopMIDI</em> (Windows).</p>
          <p><strong>2. DAW Setup:</strong> Aktiviere in den Ableton MIDI-Einstellungen den <strong>Sync</strong>-Output f√ºr dieses virtuelle Kabel.</p>
          <p><strong>3. The Pigeon:</strong> Klicke auf <strong>EXT SYNC</strong>. Sobald du in Ableton auf Play dr√ºckst, l√§uft The Pigeon phasengenau als Slave mit!</p>
        </div>

        <div class="help-section">
          <h3>4. Actions & Pattern Bank</h3>
          <p><strong>Playback Buttons:</strong> <strong>Play/Stop</strong> starts the loop (Shortcut: <em>Spacebar</em>). <strong>Clear</strong> wipes all tracks. <strong>Undo</strong> reverts your last drawing (Shortcut: <em>Ctrl/Cmd + Z</em>).</p>
          <p><strong>Data & Export:</strong> Use <strong>Export/Import Set</strong> to save your entire session as a file. <strong>Export WAV</strong> renders a perfect offline-loop to your hard drive.</p>
          <p><strong>‚è∫ Rec:</strong> Click to start live recording. Perform on the Trace Pad! Click 'Stop Rec' to download the live jam as a WAV file.</p>
          <p><strong>Pattern Bank:</strong> Save different loops into Banks A, B, C. Click <strong>‚è∫ SAVE</strong> (it pulses), then click a Pad to store. Click any Pad during playback to queue and switch patterns seamlessly.</p>
        </div>

      </div>
    </div>
  </div>

  <div id="main">
    <img id="pigeon" src="pigeon.svg" alt="Pigeon">
    
    <h1>The Pigeon</h1>
    
    <div id="tracks">
      <div class="track-container">
        <div class="wave-buttons">
          <button class="wave-btn active" data-wave="sine">‚àø</button>
          <button class="wave-btn" data-wave="square">‚éç</button>
          <button class="wave-btn" data-wave="sawtooth">‚ó∫</button>
        </div>
        <div class="track-color-strip t1-color"></div>
        <div class="legend">1k<br><br>500<br><br>250<br><br>80</div>
        <canvas id="canvas1" width="750" height="100"></canvas>
        <div class="controls-right">
            <button class="mute-btn">Mute</button>
            <div class="vol-box"><input type="range" class="volume-slider" min="0" max="1" step="0.01" value="0.8"></div>
            <label class="snap-label"><input type="checkbox" class="snap-checkbox"> Snap</label>
        </div>
      </div>

      <div class="track-container">
        <div class="wave-buttons">
          <button class="wave-btn active" data-wave="sine">‚àø</button>
          <button class="wave-btn" data-wave="square">‚éç</button>
          <button class="wave-btn" data-wave="sawtooth">‚ó∫</button>
        </div>
        <div class="track-color-strip t2-color"></div>
        <div class="legend">1k<br><br>500<br><br>250<br><br>80</div>
        <canvas id="canvas2" width="750" height="100"></canvas>
        <div class="controls-right">
            <button class="mute-btn">Mute</button>
            <div class="vol-box"><input type="range" class="volume-slider" min="0" max="1" step="0.01" value="0.8"></div>
            <label class="snap-label"><input type="checkbox" class="snap-checkbox"> Snap</label>
        </div>
      </div>

      <div class="track-container">
        <div class="wave-buttons">
          <button class="wave-btn active" data-wave="sine">‚àø</button>
          <button class="wave-btn" data-wave="square">‚éç</button>
          <button class="wave-btn" data-wave="sawtooth">‚ó∫</button>
        </div>
        <div class="track-color-strip t3-color"></div>
        <div class="legend">1k<br><br>500<br><br>250<br><br>80</div>
        <canvas id="canvas3" width="750" height="100"></canvas>
        <div class="controls-right">
            <button class="mute-btn">Mute</button>
            <div class="vol-box"><input type="range" class="volume-slider" min="0" max="1" step="0.01" value="0.8"></div>
            <label class="snap-label"><input type="checkbox" class="snap-checkbox"> Snap</label>
        </div>
      </div>

      <div class="track-container">
        <div class="wave-buttons">
          <button class="wave-btn active" data-wave="sine">‚àø</button>
          <button class="wave-btn" data-wave="square">‚éç</button>
          <button class="wave-btn" data-wave="sawtooth">‚ó∫</button>
        </div>
        <div class="track-color-strip t4-color"></div>
        <div class="legend">1k<br><br>500<br><br>250<br><br>80</div>
        <canvas id="canvas4" width="750" height="100"></canvas>
        <div class="controls-right">
            <button class="mute-btn">Mute</button>
            <div class="vol-box"><input type="range" class="volume-slider" min="0" max="1" step="0.01" value="0.8"></div>
            <label class="snap-label"><input type="checkbox" class="snap-checkbox"> Snap</label>
        </div>
      </div>
    </div>

    <div id="trace-module">
      <div class="trace-sidebar">
        <span class="label">PERFORMANCE</span>
        <div class="track-picker">
          <button class="picker-btn active t1-bg" data-target="0">T1</button>
          <button class="picker-btn t2-bg" data-target="1">T2</button>
          <button class="picker-btn t3-bg" data-target="2">T3</button>
          <button class="picker-btn t4-bg" data-target="3">T4</button>
        </div>
        <button id="traceClearBtn">Clear Track</button>
      </div>
      
      <div id="trace-pad">
        <span class="pad-hint">POKE<br>ME</span>
        <div id="trace-crosshair">
            <div class="ch-h"></div>
            <div class="ch-v"></div>
        </div>
      </div>

      <div id="fx-rack">
        <div class="fx-unit" id="fx-delay">
          <div class="fx-header">DELAY <div class="led on"></div></div>
          <div class="fx-body">
            <div class="fx-matrix">
              <div class="matrix-btn t1-bg active"></div><div class="matrix-btn t2-bg"></div>
              <div class="matrix-btn t3-bg active"></div><div class="matrix-btn t4-bg"></div>
            </div>
            <button class="fx-xy-link"></button>
            <div class="fx-knobs">
              <div class="knob-group"><div class="knob" data-val="0.4"><div class="tick"></div></div><span>TIME</span></div>
              <div class="knob-group"><div class="knob" data-val="0.3"><div class="tick"></div></div><span>FDBK</span></div>
            </div>
          </div>
        </div>

        <div class="fx-unit" id="fx-reverb">
          <div class="fx-header">REVERB <div class="led"></div></div>
          <div class="fx-body">
            <div class="fx-matrix">
              <div class="matrix-btn t1-bg"></div><div class="matrix-btn t2-bg active"></div>
              <div class="matrix-btn t3-bg"></div><div class="matrix-btn t4-bg"></div>
            </div>
            <button class="fx-xy-link"></button>
            <div class="fx-knobs">
              <div class="knob-group"><div class="knob" data-val="0.5"><div class="tick"></div></div><span>DECAY</span></div>
              <div class="knob-group"><div class="knob" data-val="0.2"><div class="tick"></div></div><span>MIX</span></div>
            </div>
          </div>
        </div>

        <div class="fx-unit" id="fx-vibrato">
          <div class="fx-header">VIBRATO <div class="led"></div></div>
          <div class="fx-body">
            <div class="fx-matrix">
              <div class="matrix-btn t1-bg active"></div><div class="matrix-btn t2-bg active"></div>
              <div class="matrix-btn t3-bg active"></div><div class="matrix-btn t4-bg active"></div>
            </div>
            <button class="fx-xy-link active"></button>
            <div class="fx-knobs">
              <div class="knob-group"><div class="knob" data-val="0.25"><div class="tick"></div></div><span>RATE</span></div>
              <div class="knob-group"><div class="knob" data-val="0.0"><div class="tick"></div></div><span>DEPTH</span></div>
            </div>
          </div>
        </div>

        <div class="fx-unit" id="fx-filter">
          <div class="fx-header">FILTER <div class="led"></div></div>
          <div class="fx-body">
            <div class="fx-matrix">
              <div class="matrix-btn t1-bg"></div><div class="matrix-btn t2-bg"></div>
              <div class="matrix-btn t3-bg"></div><div class="matrix-btn t4-bg"></div>
            </div>
            <button class="fx-xy-link"></button>
            <div class="fx-knobs">
              <div class="knob-group"><div class="knob" data-val="1.0"><div class="tick"></div></div><span>FREQ</span></div>
              <div class="knob-group"><div class="knob" data-val="0.0"><div class="tick"></div></div><span>RES</span></div>
            </div>
          </div>
        </div>

        <div class="fx-unit" id="fx-stutter">
          <div class="fx-header">STUTTER <div class="led"></div></div>
          <div class="fx-body">
            <div class="fx-matrix">
              <div class="matrix-btn t1-bg"></div><div class="matrix-btn t2-bg"></div>
              <div class="matrix-btn t3-bg"></div><div class="matrix-btn t4-bg"></div>
            </div>
            <button class="fx-xy-link"></button>
            <div class="fx-knobs">
              <div class="knob-group"><div class="knob" data-val="0.5"><div class="tick"></div></div><span>RATE</span></div>
              <div class="knob-group"><div class="knob" data-val="0.0"><div class="tick"></div></div><span>MIX</span></div>
            </div>
          </div>
        </div>

        <div class="fx-unit" id="fx-fractal">
          <div class="fx-header">FRACTAL BRUSH <div class="led" style="visibility:hidden;"></div></div>
          <div class="fx-body">
            <div class="fx-matrix" style="visibility:hidden;">
              <div class="matrix-btn t1-bg"></div><div class="matrix-btn t2-bg"></div>
              <div class="matrix-btn t3-bg"></div><div class="matrix-btn t4-bg"></div>
            </div>
            <button class="fx-xy-link"></button>
            <div class="fx-knobs">
              <div class="knob-group"><div class="knob" data-val="0.5"><div class="tick"></div></div><span>CHAOS</span></div>
              <div class="knob-group"><div class="knob" data-val="0.0"><div class="tick"></div></div><span>MORPH</span></div>
            </div>
          </div>
        </div>

      </div>
    </div>

    <div id="controls">
      <div class="controls-left">
        <div class="control-row">
          <button id="extSyncBtn">EXT SYNC</button>
          <select id="midiInputSelect" disabled style="max-width: 140px; padding: 3px; font-size: 11px; border: 1px solid #999; border-radius: 3px; background: #eee; cursor: pointer;"></select>
          
          <label>Tempo: <input type="number" id="bpmInput" value="120" min="30" max="300"></label>
          <label>Loop: <input type="checkbox" id="loopCheckbox" checked></label>
          <label>Harmonize: <input type="checkbox" id="harmonizeCheckbox"></label>
          <label id="scaleSelectContainer" style="display:none;">
            Scale: <select id="scaleSelect">
              <option value="major">Major</option>
              <option value="minor">Minor</option>
              <option value="pentatonic">Pentatonic</option>
            </select>
          </label>
        </div>
        
        <div class="control-row">
          <label>Tool: <select id="toolSelect"><option value="draw">Draw</option><option value="erase">Eraser</option></select></label>
          <label>Brush:
            <select id="brushSelect">
              <option value="standard">Standard</option>
              <option value="variable">Variable</option>
              <option value="calligraphy">Calligraphy</option>
              <option value="particles">Particles</option>
              <option value="fractal">Fractal</option>
              <option value="xenakis">Brush: Xenakids</option>
              <option value="chord">Chord</option>
            </select>
          </label>
          <label>Chord: <select id="chordSelect"><option value="major">Major</option><option value="minor">Minor</option><option value="diminished">Dim</option><option value="augmented">Aug</option><option value="sus2">Sus2</option></select></label>
          <label>Size: <input type="range" id="brushSizeSlider" min="1" max="40" value="5"></label>
        </div>

        <div class="control-row">
          <button id="playButton">Play</button>
          <button id="stopButton">Stop</button>
          <button id="clearButton">Clear</button>
          <button id="undoButton">Undo</button>
          <button id="exportButton">Export Set</button>
          <button id="importButton">Import Set</button>
          <button id="exportWavButton">Export WAV</button>
          <button id="recButton">‚è∫ Rec</button>
          <button id="fullscreenBtn">üñ• Fullscreen</button>
          <button id="helpBtn">‚ùì Help</button>
          <input type="file" id="importFileInput" style="display:none;" accept=".json">
        </div>
      </div>

      <div id="pattern-machine">
        <div class="machine-header">
          <span>PATTERN BANK</span>
          <button id="saveModeBtn">‚è∫ SAVE</button>
        </div>
        <div class="bank-row">
          <span class="bank-label">A</span>
          <button class="pad" data-bank="A" data-idx="0"></button>
          <button class="pad" data-bank="A" data-idx="1"></button>
          <button class="pad" data-bank="A" data-idx="2"></button>
          <button class="pad" data-bank="A" data-idx="3"></button>
        </div>
        <div class="bank-row">
          <span class="bank-label">B</span>
          <button class="pad" data-bank="B" data-idx="0"></button>
          <button class="pad" data-bank="B" data-idx="1"></button>
          <button class="pad" data-bank="B" data-idx="2"></button>
          <button class="pad" data-bank="B" data-idx="3"></button>
        </div>
        <div class="bank-row">
          <span class="bank-label">C</span>
          <button class="pad" data-bank="C" data-idx="0"></button>
          <button class="pad" data-bank="C" data-idx="1"></button>
          <button class="pad" data-bank="C" data-idx="2"></button>
          <button class="pad" data-bank="C" data-idx="3"></button>
        </div>
      </div>
    </div>

    <footer class="legal-footer">
      <div style="margin-bottom: 6px; font-weight: 600; color: #666; font-size: 12px;">
        &copy; 2026 thehumants.com
      </div>
      <div>
        <a href="impressum.html">Impressum</a> | <a href="datenschutz.html">Privacy Policy</a>
      </div>
    </footer>

  </div> 

  <div id="custom-eraser"></div>

  <script type="module" src="main.js"></script>
</body>
</html>